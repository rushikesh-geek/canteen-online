# Firestore Data Models

## Collection: users

**Document ID:** Firebase Auth UID

```javascript
{
  userId: string,              // Firebase Auth UID (same as document ID)
  name: string,                // Full name of user
  email: string,               // Email for authentication
  phoneNumber: string,         // Contact number
  role: string,                // "student" | "staff" | "admin"
  rfidTag: string | null,      // RFID tag ID for pickup verification (optional)
  createdAt: timestamp,        // Account creation time
  isActive: boolean            // Account status (for blocking users if needed)
}
```

---

## Collection: orders

**Document ID:** Auto-generated by Firestore

```javascript
{
  orderId: string,             // Same as document ID
  userId: string,              // Reference to users collection
  userName: string,            // Denormalized for quick display in admin queue
  
  // Order items
  items: [                     // Array of ordered items
    {
      itemName: string,        // Name of the food item
      quantity: number,        // Number of units
      price: number            // Price per unit (stored for record, not payment)
    }
  ],
  
  totalAmount: number,         // Total order cost (for display only, no payment)
  
  // Slot assignment
  slotId: string,              // Reference to orderSlots collection
  estimatedPickupTime: timestamp, // When user should pick up the order
  
  // Order lifecycle
  status: string,              // "pending" | "confirmed" | "preparing" | "ready" | "completed" | "cancelled"
  placedAt: timestamp,         // When order was created
  confirmedAt: timestamp | null,    // When canteen accepted the order
  readyAt: timestamp | null,        // When order marked ready for pickup
  completedAt: timestamp | null,    // When order was picked up
  
  // Pickup verification
  pickupVerified: boolean,     // Whether RFID verification was done at pickup
  pickupVerifiedAt: timestamp | null, // When verification happened
  
  // TODO: Define cancellation reason structure if needed
  cancellationReason: string | null  // Why order was cancelled (if applicable)
}
```

---

## Collection: orderSlots

**Document ID:** Auto-generated by Firestore

```javascript
{
  slotId: string,              // Same as document ID
  date: string,                // Date in YYYY-MM-DD format for easy querying
  startTime: timestamp,        // Slot start time
  endTime: timestamp,          // Slot end time
  
  // Capacity management
  maxCapacity: number,         // Maximum orders this slot can handle
  currentCount: number,        // Number of orders currently assigned to this slot
  
  status: string,              // "open" | "full" | "closed"
  
  // Auto cut-off metadata
  autoClosedAt: timestamp | null,    // If slot was auto-closed due to overload
  manuallyClosedBy: string | null,   // Admin user ID if manually closed
  
  createdAt: timestamp,        // When slot was created
  
  // TODO: Define how slots are generated (daily cron? manual? on-demand?)
  // TODO: Define slot duration and intervals (e.g., 15 min slots during lunch hours)
}
```

---

## Design Notes

1. **No Indexes Defined Yet** - Will add compound indexes when query patterns are clear
2. **Denormalization** - userName stored in orders for faster admin queue rendering
3. **Price Fields** - Included for order records and display, NOT for payment processing
4. **Slot Auto-Generation** - TODO: Needs business logic definition
5. **RFID Integration** - rfidTag is optional; verification happens at pickup only
6. **Real-time Updates** - All timestamps support Firestore listeners for live status updates

---

## Security Rules (Not Implemented)

- Users can only read/write their own orders
- Admins can read all orders
- Slot availability is read-only for students
- TODO: Define detailed security rules when implementing authentication
